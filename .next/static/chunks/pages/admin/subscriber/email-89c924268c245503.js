(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{67593:function(e,i,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/subscriber/email",function(){return a(32706)}])},32706:function(e,i,a){"use strict";a.r(i),a.d(i,{default:function(){return W}});var s=a(85893),t=a(67294),n=a(11163),r=a(6154),l=a(55678),u=a(85945),o=a(67848),d=a(66242),c=a(83321),m=a(65362),h=a(78591),p=a(96540),b=a(13173),x=a(22961),j=a(77957),Z=a(26307),f=a(93903),g=a(84415),k=a(82175),S=a(74231),C=a(50135),y=a(50657),P=a(31425),v=a(6514),_=a(37645),w=a(94054),T=a(47312),q=a(31085),D=a(18972),z=a(59334),A=a(69368),I=a(56815),N=a(87357),B=a(87918),E=a(90918);let L=(e,i,a)=>{let s=a.current.getContent();if(!s)return l.Am.info("Isi Email Masih Kosong");e={...e,isi:s};let t=l.Am.loading("Tunggu Sebentar...",{autoClose:!1});r.Z.post("/api/subscriber/email",e).then(e=>{setTimeout(()=>i.onClose(),2e3),i.router.push({pathname:i.router.pathname,query:i.router.query}),l.Am.update(t,{render:e.data.message,type:e.data.type,isLoading:!1,autoClose:2e3})}).catch(e=>{console.log(e.response.data),l.Am.update(t,{render:e.response.data.message,type:"error",isLoading:!1,autoClose:2e3})})},H=S.Ry({penerima:S.Z_().required("Harus Dipilih"),subjek:S.Z_().required("Harus Diisi"),list_penerima:S.IX().when("penerima",{is:e=>"Select"===e,then:S.IX().min(1,"Minimal Pilih Salah Satu Penerima"),otherwise:S.IX()})});var F=function(e){let i=(0,t.useRef)(null),a=(0,k.TA)({initialValues:{id:e.detail.id?e.detail.id:"",penerima:e.detail.penerima?e.detail.penerima:"",subjek:e.detail.subjek?e.detail.subjek:"",list_penerima:[],send:!1},enableReinitialize:!0,validationSchema:H,onSubmit:a=>L(a,e,i)});function n(e,i){i.setFieldValue("send",e,i.handleSubmit())}return((0,t.useEffect)(()=>{e.open||a.resetForm()},[e.open]),(0,t.useEffect)(()=>{a.setFieldValue("list_penerima",[])},[a.values.penerima]),0===e.subscriber.length)?(0,s.jsxs)(y.Z,{open:e.open,onClose:e.onClose,fullScreen:!1,children:[(0,s.jsx)(_.Z,{children:"Tidak Memiliki Subscriber"}),(0,s.jsx)(P.Z,{children:(0,s.jsx)(c.Z,{onClick:e.onClose,type:"button",children:"Tutup"})})]}):(0,s.jsx)(y.Z,{open:e.open,onClose:e.onClose,fullScreen:!0,children:(0,s.jsxs)("form",{onSubmit:a.handleSubmit,children:[(0,s.jsxs)(v.Z,{children:[(0,s.jsxs)(w.Z,{fullWidth:!0,error:a.touched.penerima&&Boolean(a.errors.penerima),children:[(0,s.jsx)(T.Z,{children:"Penerima *"}),(0,s.jsxs)(q.Z,{name:"penerima",label:"Penerima *",value:a.values.penerima,onChange:a.handleChange,onBlur:a.handleBlur,children:[(0,s.jsx)(D.Z,{value:"All",children:"Semua Subscriber"}),(0,s.jsx)(D.Z,{value:"Select",children:"Pilih Dari Daftar"})]}),(0,s.jsx)(I.Z,{children:a.touched.penerima&&a.errors.penerima})]}),"Select"===a.values.penerima&&(0,s.jsx)(B.Z,{label:a.values.list_penerima.length+" Penerima"}),"All"===a.values.penerima&&(0,s.jsx)(B.Z,{label:e.subscriber.length+" Penerima"}),"Select"===a.values.penerima&&(0,s.jsxs)(w.Z,{fullWidth:!0,sx:{mt:2},error:a.touched.list_penerima&&Boolean(a.errors.list_penerima),children:[(0,s.jsx)(T.Z,{id:"demo-multiple-chip-label",children:"Pilih Penerima *"}),(0,s.jsx)(q.Z,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,name:"list_penerima",label:"Pilih Penerima *",value:a.values.list_penerima,onChange:a.handleChange,onBlur:a.handleBlur,renderValue:e=>(0,s.jsx)(N.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>(0,s.jsx)(B.Z,{label:e},e))}),MenuProps:{PaperProps:{style:{maxHeight:224,width:250}}},children:e.subscriber.map(e=>(0,s.jsxs)(D.Z,{value:e.email_subscriber,children:[(0,s.jsx)(A.Z,{checked:a.values.list_penerima.indexOf(e.email_subscriber)>-1}),(0,s.jsx)(z.Z,{primary:e.email_subscriber})]},e.id))}),(0,s.jsx)(I.Z,{children:a.touched.list_penerima&&a.errors.list_penerima})]}),(0,s.jsx)(C.Z,{sx:{mb:2},fullWidth:!0,required:!0,margin:"normal",label:"Subjek",name:"subjek",value:a.values.subjek,onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.subjek&&Boolean(a.errors.subjek),helperText:a.touched.subjek&&a.errors.subjek}),(0,s.jsx)(E.M,{onInit:(e,a)=>i.current=a,apiKey:"mgdq5xn0ze8c48b5urdackwvsitkys648xw6lvt5ea9s40qy",initialValue:e.detail.isi?e.detail.isi:"",init:{height:400,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste wordcount"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})]}),(0,s.jsxs)(P.Z,{children:[(0,s.jsx)(c.Z,{type:"button",onClick:e=>n(!0,a),children:"Kirim dan Tutup"}),(0,s.jsx)(c.Z,{type:"button",onClick:e=>n(!1,a),children:"Draft dan Tutup"}),(0,s.jsx)(c.Z,{type:"button",onClick:e.onClose,children:"Buang"})]})]})})};function M(){let e=(0,u.NL)(),i=(0,n.useRouter)(),{status:a}=i.query,[k,S]=(0,t.useState)(10),[C,y]=(0,t.useState)([]),[P,v]=(0,t.useState)(!1),[_,w]=(0,t.useState)({}),{data:T,isLoading:q,isFetching:D}=(0,o.a)({queryKey:["emails","draft"===a?{status:0}:{status:1}],queryFn:e=>{let{signal:i}=e;return r.Z.get("draft"===a?"/api/subscriber/email?status=0":"/api/subscriber/email?status=1",{signal:i}).then(e=>e.data).catch(e=>{throw Error(e.response.data.message)})}}),{data:z}=(0,o.a)({queryKey:["subscribers"],queryFn:e=>{let{signal:i}=e;return r.Z.get("/api/subscriber",{signal:i}).then(e=>e.data).catch(e=>{throw Error(e.response.data.message)})}}),A=()=>{v(!1),w({})},I=i=>{let a=confirm("Yakin Hapus Data?");if(a){let a=l.Am.loading("Tunggu Sebentar...",{autoClose:!1});r.Z.delete("/api/subscriber/email/".concat(i)).then(i=>{setTimeout(()=>{e.invalidateQueries(["emails"])}),l.Am.update(a,{render:i.data.message,type:"success",isLoading:!1,autoClose:2e3})}).catch(e=>{l.Am.update(a,{render:e.response.data.message,type:"error",isLoading:!1,autoClose:2e3})})}},N=()=>{let i=confirm("Yakin Hapus Data Terpilih?");if(i){let i=l.Am.loading("Tunggu Sebentar...",{autoClose:!1});r.Z.delete("/api/subscriber/email",{data:C}).then(a=>{setTimeout(()=>{e.invalidateQueries(["emails"])}),l.Am.update(i,{render:a.data.message,type:"success",isLoading:!1,autoClose:2e3})}).catch(e=>{l.Am.update(i,{render:e.response.data.message,type:"error",isLoading:!1,autoClose:2e3})})}},B=e=>{v(!0),w(i=>e)};return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(c.Z,{variant:"outlined",sx:{mb:2},onClick:()=>v(!0),startIcon:(0,s.jsx)(p.Z,{}),children:"Tulis"}),(0,s.jsx)(c.Z,{variant:"outlined",disabled:"send"===i.query.status||!i.query.status,sx:{mb:2,mx:2},onClick:()=>{i.push({pathname:"/admin/subscriber/email",query:{status:"send"}})},startIcon:(0,s.jsx)(Z.Z,{}),children:"Terkirim"}),(0,s.jsx)(c.Z,{variant:"outlined",disabled:"draft"===i.query.status,sx:{mb:2},onClick:()=>{i.push({pathname:"/admin/subscriber/email",query:{status:"draft"}})},startIcon:(0,s.jsx)(f.Z,{}),children:"Draft"}),(0,s.jsx)(h._,{loading:q||D,autoHeight:!0,rows:T||[],columns:[{field:"nama_bawaslu",headerName:"Oleh",minWidth:200},{field:"penerima",headerName:"Penerima",minWidth:180},{field:"subjek",headerName:"Subjek",minWidth:180,flex:1},{field:"actions",type:"actions",headerName:"Actions",width:200,cellClassName:"actions",getActions:e=>0===e.row.status?[(0,s.jsx)(m.u,{icon:(0,s.jsx)(j.Z,{}),label:"Tulis Ulang",onClick:()=>B(e.row)},"0"),(0,s.jsx)(m.u,{icon:(0,s.jsx)(b.Z,{}),label:"Delete",onClick:()=>I(e.id)},"1")]:[(0,s.jsx)(m.u,{icon:(0,s.jsx)(x.Z,{}),label:"Detail",onClick:()=>i.push("/admin/subscriber/email/"+e.id)},"0"),(0,s.jsx)(m.u,{icon:(0,s.jsx)(b.Z,{}),label:"Delete",onClick:()=>I(e.id)},"1")]}],pageSize:k,onPageSizeChange:e=>S(e),rowsPerPageOptions:[5,10,20],checkboxSelection:!0,disableSelectionOnClick:!0,onSelectionModelChange:e=>y(e),components:{Toolbar:g.N},componentsProps:{toolbar:{selectedItem:C,handleDeleteSelected:N}}}),(0,s.jsx)(F,{open:P,onClose:A,subscriber:z||[],detail:_,router:i})]})}M.auth=!0,M.breadcrumb=[{path:"/admin",title:"Home"},{path:"/admin/subscriber",title:"Subscriber"},{path:"/admin/subscriber/email",title:"Email"}];var W=M},84415:function(e,i,a){"use strict";a.d(i,{D:function(){return f},N:function(){return Z}});var s=a(85893),t=a(83321),n=a(86886),r=a(13173),l=a(9944),u=a(93946),o=a(34386),d=a(42176),c=a(6132),m=a(50853),h=a(54482),p=a(10930),b=a(36433);let x=e=>{let{selectedItem:i,handleDeleteSelected:a}=e;return(0,s.jsxs)(t.Z,{variant:"text",size:"small",startIcon:(0,s.jsx)(r.Z,{}),disabled:0===i.length,onClick:a,children:["Hapus ",i.length," Data Terpilih"]})},j=()=>(0,s.jsx)(t.Z,{sx:{fontSize:12},variant:"text",size:"small",startIcon:(0,s.jsx)(l.Z,{}),onClick:()=>window.open("https://www.adinstruments.com/support/knowledge-base/how-can-comma-separated-list-be-converted-cells-column-lt","_blank"),children:"Bantuan"});function Z(e){return(0,s.jsx)(d.D,{children:(0,s.jsxs)(n.ZP,{container:!0,spacing:1,justify:"space-between",children:[(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(c.S,{})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(m.M,{})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(h.L,{})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(p.Zh,{})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(j,{})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(x,{selectedItem:e.selectedItem,handleDeleteSelected:e.handleDeleteSelected})}),(0,s.jsxs)(n.ZP,{item:!0,xs:12,children:[(0,s.jsx)(b.T,{quickFilterParser:e=>e.split(",").map(e=>e.trim()).filter(e=>""!==e)}),e.multiSearch&&(0,s.jsx)(o.Z,{title:"Jika Lebih dari satu pencarian, gunakan tanda koma (,)",children:(0,s.jsx)(u.Z,{size:"small",children:(0,s.jsx)(l.Z,{fontSize:"inherit"})})})]})]})})}function f(e){return(0,s.jsx)(d.D,{children:(0,s.jsxs)(n.ZP,{container:!0,spacing:1,children:[(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(c.S,{sx:{fontSize:12}})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(h.L,{sx:{fontSize:12}})}),(0,s.jsx)(n.ZP,{item:!0,children:(0,s.jsx)(p.Zh,{sx:{fontSize:12}})}),(0,s.jsx)(n.ZP,{item:!0,sx:{mr:3},children:(0,s.jsx)(j,{sx:{fontSize:12}})}),(0,s.jsxs)(n.ZP,{sx:{pt:1,ml:1},children:[(0,s.jsx)(b.T,{quickFilterParser:e=>e.split(",").map(e=>e.trim()).filter(e=>""!==e)}),(0,s.jsx)(o.Z,{title:"Jika Lebih dari satu pencarian, gunakan tanda koma (,)",children:(0,s.jsx)(u.Z,{size:"small",children:(0,s.jsx)(l.Z,{fontSize:"inherit"})})})]})]})})}}},function(e){e.O(0,[9004,6886,8271,7848,5015,5382,7085,9774,2888,179],function(){return e(e.s=67593)}),_N_E=e.O()}]);